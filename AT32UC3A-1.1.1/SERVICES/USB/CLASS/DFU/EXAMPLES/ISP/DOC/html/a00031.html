<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>AVR32 - USB DFU Example: ISP: usb_dfu.h File Reference</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.5.1-p1 -->
<div class="tabs">
  <ul>
    <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
    <li><a href="modules.html"><span>Modules</span></a></li>
    <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
    <li id="current"><a href="files.html"><span>Files</span></a></li>
  </ul></div>
<div class="tabs">
  <ul>
    <li><a href="files.html"><span>File&nbsp;List</span></a></li>
    <li><a href="globals.html"><span>Globals</span></a></li>
  </ul></div>
<h1>usb_dfu.h File Reference</h1><hr><a name="_details"></a><h2>Detailed Description</h2>
Management of the USB device firmware upgrade. 
<p>
This file manages the USB device firmware upgrade.<p>
<ul>
<li>Compiler: IAR EWAVR32 and GNU GCC for AVR32</li><li>Supported devices: All AVR32 devices with a USB module can be used.</li><li>AppNote:</li></ul>
<p>
<dl class="author" compact><dt><b>Author:</b></dt><dd>Atmel Corporation: <a href="http://www.atmel.com">http://www.atmel.com</a> <br>
 Support and FAQ: <a href="http://support.atmel.no/">http://support.atmel.no/</a> </dd></dl>

<p>
Definition in file <a class="el" href="a00056.html">usb_dfu.h</a>.
<p>
<code>#include &quot;<a class="el" href="a00044.html">conf_usb.h</a>&quot;</code><br>
<code>#include &quot;compiler.h&quot;</code><br>

<p>
<a href="a00056.html">Go to the source code of this file.</a><table border="0" cellpadding="0" cellspacing="0">
<tr><td></td></tr>
<tr><td colspan="2"><br><h2>Defines</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00031.html#35c0d433877f35c101c406d7b30136bc">STATE_appDETACH</a>&nbsp;&nbsp;&nbsp;0x01</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00031.html#a76e57cbeee1e2ebe0c7ea356c6da63b">STATE_appIDLE</a>&nbsp;&nbsp;&nbsp;0x00</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00031.html#307e6d67666c8116a6e6d62a70303c5e">STATE_dfuDNBUSY</a>&nbsp;&nbsp;&nbsp;0x04</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00031.html#5fd15db92a8f8bca7b1b974c5229350e">STATE_dfuDNLOAD_IDLE</a>&nbsp;&nbsp;&nbsp;0x05</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00031.html#33d10a07e59bff9ec5695e4ff2407f81">STATE_dfuDNLOAD_SYNC</a>&nbsp;&nbsp;&nbsp;0x03</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00031.html#ecc2eec53693b6463a727e4643cda1a7">STATE_dfuERROR</a>&nbsp;&nbsp;&nbsp;0x0A</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00031.html#63b31ba28976a95861ceac8ca590cce6">STATE_dfuIDLE</a>&nbsp;&nbsp;&nbsp;0x02</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00031.html#4b32e6fb4fc800e49ed16a3a353ac6e4">STATE_dfuMANIFEST</a>&nbsp;&nbsp;&nbsp;0x07</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00031.html#38c85181a1c64c25c3190c37ee57f0f7">STATE_dfuMANIFEST_SYNC</a>&nbsp;&nbsp;&nbsp;0x06</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00031.html#c4b4d8cc3bc7484ab849f44fad5f3d1a">STATE_dfuMANIFEST_WAIT_RESET</a>&nbsp;&nbsp;&nbsp;0x08</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00031.html#f26c02c94dff2b5184a8f67b15719290">STATE_dfuUPLOAD_IDLE</a>&nbsp;&nbsp;&nbsp;0x09</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00031.html#e32f24e7d30d446dd9f487f4d5e55742">STATUS_errADDRESS</a>&nbsp;&nbsp;&nbsp;0x08</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00031.html#bef4e4e1a2737dec9c0e1412b66b7636">STATUS_errCHECK_ERASED</a>&nbsp;&nbsp;&nbsp;0x05</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00031.html#dce99a71dacd78cb8a38b00ebf19df1f">STATUS_errERASE</a>&nbsp;&nbsp;&nbsp;0x04</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00031.html#45ecb888aaafa3002be32462160ce08f">STATUS_errFILE</a>&nbsp;&nbsp;&nbsp;0x02</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00031.html#59addabfd0062ade5499bd202e686173">STATUS_errFIRMWARE</a>&nbsp;&nbsp;&nbsp;0x0A</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00031.html#515b13b323d70f3a37b75293aac45030">STATUS_errNOTDONE</a>&nbsp;&nbsp;&nbsp;0x09</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00031.html#2a2a47822dab4b18eff0f23091dd3037">STATUS_errPOR</a>&nbsp;&nbsp;&nbsp;0x0D</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00031.html#4772f3cdd779b85988d601698eacd54a">STATUS_errPROG</a>&nbsp;&nbsp;&nbsp;0x06</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00031.html#ff7b3e2c3070cd0238186033151c4796">STATUS_errSTALLEDPKT</a>&nbsp;&nbsp;&nbsp;0x0F</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00031.html#1f453b789482092c4b82cf0c0e6ec512">STATUS_errTARGET</a>&nbsp;&nbsp;&nbsp;0x01</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00031.html#d66338204c9f26d25d084cf9a3577c5b">STATUS_errUNKNOWN</a>&nbsp;&nbsp;&nbsp;0x0E</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00031.html#c2d30d7eb2089c367c28b85cc1dc738c">STATUS_errUSBR</a>&nbsp;&nbsp;&nbsp;0x0C</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00031.html#d835848dd7e23227147884371bfee463">STATUS_errVENDOR</a>&nbsp;&nbsp;&nbsp;0x0B</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00031.html#0d02117b3b3ac0e37ea30c91a7f2a43a">STATUS_errVERIFY</a>&nbsp;&nbsp;&nbsp;0x07</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00031.html#fd69c5c712eb452dce7b77919198dfba">STATUS_errWRITE</a>&nbsp;&nbsp;&nbsp;0x03</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00031.html#2403320c41f08e7567cb169de5db66b3">STATUS_OK</a>&nbsp;&nbsp;&nbsp;0x00</td></tr>

<tr><td colspan="2"><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">Bool&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00031.html#15eaa33f32d6fde4ea8ba7e408b9492a">usb_dfu_dnload</a> (void)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Management of the DFU_DNLOAD requests.  <a href="#15eaa33f32d6fde4ea8ba7e408b9492a"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00031.html#62dbc4daf5f5254dc94c0b1c00ae1979">usb_dfu_init</a> (void)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">Bool&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00031.html#e699cfe7ed5c0b528f080d5e056a1503">usb_dfu_upload</a> (void)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Management of the DFU_UPLOAD requests.  <a href="#e699cfe7ed5c0b528f080d5e056a1503"></a><br></td></tr>
<tr><td colspan="2"><br><h2>Variables</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">U8&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00031.html#ab5b7c0a4e01dcfaa3985722d933afbe">usb_dfu_state</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">U8&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00031.html#dab58f74f165f09a20d44012d0e5b701">usb_dfu_status</a></td></tr>

</table>
<hr><h2>Define Documentation</h2>
<a class="anchor" name="35c0d433877f35c101c406d7b30136bc"></a><!-- doxytag: member="usb_dfu.h::STATE_appDETACH" ref="35c0d433877f35c101c406d7b30136bc" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define STATE_appDETACH&nbsp;&nbsp;&nbsp;0x01          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>
Definition at line <a class="el" href="a00056.html#l00083">83</a> of file <a class="el" href="a00056.html">usb_dfu.h</a>.
</div>
</div><p>
<a class="anchor" name="a76e57cbeee1e2ebe0c7ea356c6da63b"></a><!-- doxytag: member="usb_dfu.h::STATE_appIDLE" ref="a76e57cbeee1e2ebe0c7ea356c6da63b" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define STATE_appIDLE&nbsp;&nbsp;&nbsp;0x00          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>
Definition at line <a class="el" href="a00056.html#l00082">82</a> of file <a class="el" href="a00056.html">usb_dfu.h</a>.
</div>
</div><p>
<a class="anchor" name="307e6d67666c8116a6e6d62a70303c5e"></a><!-- doxytag: member="usb_dfu.h::STATE_dfuDNBUSY" ref="307e6d67666c8116a6e6d62a70303c5e" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define STATE_dfuDNBUSY&nbsp;&nbsp;&nbsp;0x04          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>
Definition at line <a class="el" href="a00056.html#l00086">86</a> of file <a class="el" href="a00056.html">usb_dfu.h</a>.
</div>
</div><p>
<a class="anchor" name="5fd15db92a8f8bca7b1b974c5229350e"></a><!-- doxytag: member="usb_dfu.h::STATE_dfuDNLOAD_IDLE" ref="5fd15db92a8f8bca7b1b974c5229350e" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define STATE_dfuDNLOAD_IDLE&nbsp;&nbsp;&nbsp;0x05          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>
Definition at line <a class="el" href="a00056.html#l00087">87</a> of file <a class="el" href="a00056.html">usb_dfu.h</a>.
</div>
</div><p>
<a class="anchor" name="33d10a07e59bff9ec5695e4ff2407f81"></a><!-- doxytag: member="usb_dfu.h::STATE_dfuDNLOAD_SYNC" ref="33d10a07e59bff9ec5695e4ff2407f81" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define STATE_dfuDNLOAD_SYNC&nbsp;&nbsp;&nbsp;0x03          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>
Definition at line <a class="el" href="a00056.html#l00085">85</a> of file <a class="el" href="a00056.html">usb_dfu.h</a>.
</div>
</div><p>
<a class="anchor" name="ecc2eec53693b6463a727e4643cda1a7"></a><!-- doxytag: member="usb_dfu.h::STATE_dfuERROR" ref="ecc2eec53693b6463a727e4643cda1a7" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define STATE_dfuERROR&nbsp;&nbsp;&nbsp;0x0A          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>
Definition at line <a class="el" href="a00056.html#l00092">92</a> of file <a class="el" href="a00056.html">usb_dfu.h</a>.
<p>
Referenced by <a class="el" href="a00057.html#l00087">usb_user_read_request()</a>.
</div>
</div><p>
<a class="anchor" name="63b31ba28976a95861ceac8ca590cce6"></a><!-- doxytag: member="usb_dfu.h::STATE_dfuIDLE" ref="63b31ba28976a95861ceac8ca590cce6" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define STATE_dfuIDLE&nbsp;&nbsp;&nbsp;0x02          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>
Definition at line <a class="el" href="a00056.html#l00084">84</a> of file <a class="el" href="a00056.html">usb_dfu.h</a>.
<p>
Referenced by <a class="el" href="a00057.html#l00087">usb_user_read_request()</a>.
</div>
</div><p>
<a class="anchor" name="4b32e6fb4fc800e49ed16a3a353ac6e4"></a><!-- doxytag: member="usb_dfu.h::STATE_dfuMANIFEST" ref="4b32e6fb4fc800e49ed16a3a353ac6e4" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define STATE_dfuMANIFEST&nbsp;&nbsp;&nbsp;0x07          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>
Definition at line <a class="el" href="a00056.html#l00089">89</a> of file <a class="el" href="a00056.html">usb_dfu.h</a>.
</div>
</div><p>
<a class="anchor" name="38c85181a1c64c25c3190c37ee57f0f7"></a><!-- doxytag: member="usb_dfu.h::STATE_dfuMANIFEST_SYNC" ref="38c85181a1c64c25c3190c37ee57f0f7" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define STATE_dfuMANIFEST_SYNC&nbsp;&nbsp;&nbsp;0x06          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>
Definition at line <a class="el" href="a00056.html#l00088">88</a> of file <a class="el" href="a00056.html">usb_dfu.h</a>.
</div>
</div><p>
<a class="anchor" name="c4b4d8cc3bc7484ab849f44fad5f3d1a"></a><!-- doxytag: member="usb_dfu.h::STATE_dfuMANIFEST_WAIT_RESET" ref="c4b4d8cc3bc7484ab849f44fad5f3d1a" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define STATE_dfuMANIFEST_WAIT_RESET&nbsp;&nbsp;&nbsp;0x08          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>
Definition at line <a class="el" href="a00056.html#l00090">90</a> of file <a class="el" href="a00056.html">usb_dfu.h</a>.
</div>
</div><p>
<a class="anchor" name="f26c02c94dff2b5184a8f67b15719290"></a><!-- doxytag: member="usb_dfu.h::STATE_dfuUPLOAD_IDLE" ref="f26c02c94dff2b5184a8f67b15719290" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define STATE_dfuUPLOAD_IDLE&nbsp;&nbsp;&nbsp;0x09          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>
Definition at line <a class="el" href="a00056.html#l00091">91</a> of file <a class="el" href="a00056.html">usb_dfu.h</a>.
</div>
</div><p>
<a class="anchor" name="e32f24e7d30d446dd9f487f4d5e55742"></a><!-- doxytag: member="usb_dfu.h::STATUS_errADDRESS" ref="e32f24e7d30d446dd9f487f4d5e55742" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define STATUS_errADDRESS&nbsp;&nbsp;&nbsp;0x08          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>
Definition at line <a class="el" href="a00056.html#l00072">72</a> of file <a class="el" href="a00056.html">usb_dfu.h</a>.
<p>
Referenced by <a class="el" href="a00055.html#l00314">get_and_check_mem_range()</a>, and <a class="el" href="a00055.html#l00529">usb_dfu_dnload()</a>.
</div>
</div><p>
<a class="anchor" name="bef4e4e1a2737dec9c0e1412b66b7636"></a><!-- doxytag: member="usb_dfu.h::STATUS_errCHECK_ERASED" ref="bef4e4e1a2737dec9c0e1412b66b7636" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define STATUS_errCHECK_ERASED&nbsp;&nbsp;&nbsp;0x05          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>
Definition at line <a class="el" href="a00056.html#l00069">69</a> of file <a class="el" href="a00056.html">usb_dfu.h</a>.
<p>
Referenced by <a class="el" href="a00055.html#l00402">erase_check_mem()</a>, <a class="el" href="a00055.html#l00529">usb_dfu_dnload()</a>, and <a class="el" href="a00055.html#l00721">usb_dfu_upload()</a>.
</div>
</div><p>
<a class="anchor" name="dce99a71dacd78cb8a38b00ebf19df1f"></a><!-- doxytag: member="usb_dfu.h::STATUS_errERASE" ref="dce99a71dacd78cb8a38b00ebf19df1f" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define STATUS_errERASE&nbsp;&nbsp;&nbsp;0x04          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>
Definition at line <a class="el" href="a00056.html#l00068">68</a> of file <a class="el" href="a00056.html">usb_dfu.h</a>.
</div>
</div><p>
<a class="anchor" name="45ecb888aaafa3002be32462160ce08f"></a><!-- doxytag: member="usb_dfu.h::STATUS_errFILE" ref="45ecb888aaafa3002be32462160ce08f" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define STATUS_errFILE&nbsp;&nbsp;&nbsp;0x02          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>
Definition at line <a class="el" href="a00056.html#l00066">66</a> of file <a class="el" href="a00056.html">usb_dfu.h</a>.
</div>
</div><p>
<a class="anchor" name="59addabfd0062ade5499bd202e686173"></a><!-- doxytag: member="usb_dfu.h::STATUS_errFIRMWARE" ref="59addabfd0062ade5499bd202e686173" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define STATUS_errFIRMWARE&nbsp;&nbsp;&nbsp;0x0A          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>
Definition at line <a class="el" href="a00056.html#l00074">74</a> of file <a class="el" href="a00056.html">usb_dfu.h</a>.
</div>
</div><p>
<a class="anchor" name="515b13b323d70f3a37b75293aac45030"></a><!-- doxytag: member="usb_dfu.h::STATUS_errNOTDONE" ref="515b13b323d70f3a37b75293aac45030" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define STATUS_errNOTDONE&nbsp;&nbsp;&nbsp;0x09          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>
Definition at line <a class="el" href="a00056.html#l00073">73</a> of file <a class="el" href="a00056.html">usb_dfu.h</a>.
</div>
</div><p>
<a class="anchor" name="2a2a47822dab4b18eff0f23091dd3037"></a><!-- doxytag: member="usb_dfu.h::STATUS_errPOR" ref="2a2a47822dab4b18eff0f23091dd3037" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define STATUS_errPOR&nbsp;&nbsp;&nbsp;0x0D          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>
Definition at line <a class="el" href="a00056.html#l00077">77</a> of file <a class="el" href="a00056.html">usb_dfu.h</a>.
</div>
</div><p>
<a class="anchor" name="4772f3cdd779b85988d601698eacd54a"></a><!-- doxytag: member="usb_dfu.h::STATUS_errPROG" ref="4772f3cdd779b85988d601698eacd54a" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define STATUS_errPROG&nbsp;&nbsp;&nbsp;0x06          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>
Definition at line <a class="el" href="a00056.html#l00070">70</a> of file <a class="el" href="a00056.html">usb_dfu.h</a>.
</div>
</div><p>
<a class="anchor" name="ff7b3e2c3070cd0238186033151c4796"></a><!-- doxytag: member="usb_dfu.h::STATUS_errSTALLEDPKT" ref="ff7b3e2c3070cd0238186033151c4796" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define STATUS_errSTALLEDPKT&nbsp;&nbsp;&nbsp;0x0F          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>
Definition at line <a class="el" href="a00056.html#l00079">79</a> of file <a class="el" href="a00056.html">usb_dfu.h</a>.
<p>
Referenced by <a class="el" href="a00055.html#l00529">usb_dfu_dnload()</a>, <a class="el" href="a00055.html#l00721">usb_dfu_upload()</a>, and <a class="el" href="a00057.html#l00087">usb_user_read_request()</a>.
</div>
</div><p>
<a class="anchor" name="1f453b789482092c4b82cf0c0e6ec512"></a><!-- doxytag: member="usb_dfu.h::STATUS_errTARGET" ref="1f453b789482092c4b82cf0c0e6ec512" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define STATUS_errTARGET&nbsp;&nbsp;&nbsp;0x01          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>
Definition at line <a class="el" href="a00056.html#l00065">65</a> of file <a class="el" href="a00056.html">usb_dfu.h</a>.
</div>
</div><p>
<a class="anchor" name="d66338204c9f26d25d084cf9a3577c5b"></a><!-- doxytag: member="usb_dfu.h::STATUS_errUNKNOWN" ref="d66338204c9f26d25d084cf9a3577c5b" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define STATUS_errUNKNOWN&nbsp;&nbsp;&nbsp;0x0E          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>
Definition at line <a class="el" href="a00056.html#l00078">78</a> of file <a class="el" href="a00056.html">usb_dfu.h</a>.
</div>
</div><p>
<a class="anchor" name="c2d30d7eb2089c367c28b85cc1dc738c"></a><!-- doxytag: member="usb_dfu.h::STATUS_errUSBR" ref="c2d30d7eb2089c367c28b85cc1dc738c" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define STATUS_errUSBR&nbsp;&nbsp;&nbsp;0x0C          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>
Definition at line <a class="el" href="a00056.html#l00076">76</a> of file <a class="el" href="a00056.html">usb_dfu.h</a>.
</div>
</div><p>
<a class="anchor" name="d835848dd7e23227147884371bfee463"></a><!-- doxytag: member="usb_dfu.h::STATUS_errVENDOR" ref="d835848dd7e23227147884371bfee463" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define STATUS_errVENDOR&nbsp;&nbsp;&nbsp;0x0B          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>
Definition at line <a class="el" href="a00056.html#l00075">75</a> of file <a class="el" href="a00056.html">usb_dfu.h</a>.
</div>
</div><p>
<a class="anchor" name="0d02117b3b3ac0e37ea30c91a7f2a43a"></a><!-- doxytag: member="usb_dfu.h::STATUS_errVERIFY" ref="0d02117b3b3ac0e37ea30c91a7f2a43a" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define STATUS_errVERIFY&nbsp;&nbsp;&nbsp;0x07          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>
Definition at line <a class="el" href="a00056.html#l00071">71</a> of file <a class="el" href="a00056.html">usb_dfu.h</a>.
<p>
Referenced by <a class="el" href="a00055.html#l00529">usb_dfu_dnload()</a>.
</div>
</div><p>
<a class="anchor" name="fd69c5c712eb452dce7b77919198dfba"></a><!-- doxytag: member="usb_dfu.h::STATUS_errWRITE" ref="fd69c5c712eb452dce7b77919198dfba" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define STATUS_errWRITE&nbsp;&nbsp;&nbsp;0x03          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>
Definition at line <a class="el" href="a00056.html#l00067">67</a> of file <a class="el" href="a00056.html">usb_dfu.h</a>.
<p>
Referenced by <a class="el" href="a00055.html#l00529">usb_dfu_dnload()</a>.
</div>
</div><p>
<a class="anchor" name="2403320c41f08e7567cb169de5db66b3"></a><!-- doxytag: member="usb_dfu.h::STATUS_OK" ref="2403320c41f08e7567cb169de5db66b3" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define STATUS_OK&nbsp;&nbsp;&nbsp;0x00          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>
Definition at line <a class="el" href="a00056.html#l00064">64</a> of file <a class="el" href="a00056.html">usb_dfu.h</a>.
<p>
Referenced by <a class="el" href="a00055.html#l00529">usb_dfu_dnload()</a>, <a class="el" href="a00055.html#l00721">usb_dfu_upload()</a>, and <a class="el" href="a00057.html#l00087">usb_user_read_request()</a>.
</div>
</div><p>
<hr><h2>Function Documentation</h2>
<a class="anchor" name="15eaa33f32d6fde4ea8ba7e408b9492a"></a><!-- doxytag: member="usb_dfu.h::usb_dfu_dnload" ref="15eaa33f32d6fde4ea8ba7e408b9492a" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">Bool usb_dfu_dnload           </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname">          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Management of the DFU_DNLOAD requests. 
<p>

<p>
Definition at line <a class="el" href="a00055.html#l00529">529</a> of file <a class="el" href="a00055.html">usb_dfu.c</a>.
<p>
References <a class="el" href="a00016.html#628154782d795e03dc8a807545dd0622">boot_program()</a>, <a class="el" href="a00055.html#l00100">CMD_BLANK_CHECK</a>, <a class="el" href="a00055.html#l00103">CMD_ERASE</a>, <a class="el" href="a00055.html#l00110">CMD_ERASE_ARG_CHIP</a>, <a class="el" href="a00055.html#l00090">CMD_GRP_DNLOAD</a>, <a class="el" href="a00055.html#l00092">CMD_GRP_EXEC</a>, <a class="el" href="a00055.html#l00093">CMD_GRP_SELECT</a>, <a class="el" href="a00055.html#l00091">CMD_GRP_UPLOAD</a>, <a class="el" href="a00055.html#l00096">CMD_PROGRAM_START</a>, <a class="el" href="a00055.html#l00099">CMD_READ_MEMORY</a>, <a class="el" href="a00055.html#l00107">CMD_SELECT_MEMORY</a>, <a class="el" href="a00055.html#l00118">CMD_SELECT_MEMORY_ARG_PAGE</a>, <a class="el" href="a00055.html#l00117">CMD_SELECT_MEMORY_ARG_UNIT</a>, <a class="el" href="a00055.html#l00104">CMD_START_APPLI</a>, <a class="el" href="a00055.html#l00114">CMD_START_APPLI_ARG_NO_RESET</a>, <a class="el" href="a00055.html#l00113">CMD_START_APPLI_ARG_RESET</a>, <a class="el" href="a00055.html#l00293">end_address</a>, <a class="el" href="a00055.html#l00402">erase_check_mem()</a>, <a class="el" href="a00045.html#l00616">flashc_erase_all_pages()</a>, <a class="el" href="a00045.html#l00374">flashc_lock_all_regions()</a>, <a class="el" href="a00055.html#l00308">force_isp()</a>, <a class="el" href="a00055.html#l00314">get_and_check_mem_range()</a>, <a class="el" href="a00055.html#l00302">is_isp_forced()</a>, <a class="el" href="a00055.html#l00168">address_t::long_address</a>, <a class="el" href="a00055.html#l00125">MEM_BOOTLOADER</a>, <a class="el" href="a00055.html#l00124">MEM_CONFIGURATION</a>, <a class="el" href="a00055.html#l00122">MEM_EEPROM</a>, <a class="el" href="a00055.html#l00121">MEM_FLASH</a>, <a class="el" href="a00055.html#l00123">MEM_SECURITY</a>, <a class="el" href="a00055.html#l00126">MEM_SIGNATURE</a>, <a class="el" href="a00055.html#l00127">MEM_USER</a>, <a class="el" href="a00030.html#25bcfc8e0357e922449012b0d41e30c7">MEMORY_ACCESS</a>, <a class="el" href="a00055.html#l00190">MEMORY_END_ADDRESS</a>, <a class="el" href="a00055.html#l00171">address_t::page</a>, <a class="el" href="a00030.html#2ee0f257169fa94a36a103b84afa7101">read</a>, <a class="el" href="a00055.html#l00292">start_address</a>, <a class="el" href="a00056.html#l00072">STATUS_errADDRESS</a>, <a class="el" href="a00056.html#l00069">STATUS_errCHECK_ERASED</a>, <a class="el" href="a00056.html#l00079">STATUS_errSTALLEDPKT</a>, <a class="el" href="a00056.html#l00071">STATUS_errVERIFY</a>, <a class="el" href="a00056.html#l00067">STATUS_errWRITE</a>, <a class="el" href="a00056.html#l00064">STATUS_OK</a>, <a class="el" href="a00049.html#l00174">sys_clk_gen_stop()</a>, <a class="el" href="a00055.html#l00506">usb_dfu_stop()</a>, <a class="el" href="a00049.html#l00066">wait_10_ms()</a>, <a class="el" href="a00030.html#76c4ac28168870c768186fd58667751c">write</a>, and <a class="el" href="a00055.html#l00454">write_mem()</a>.
<p>
Referenced by <a class="el" href="a00057.html#l00087">usb_user_read_request()</a>.<div class="fragment"><pre class="fragment"><a name="l00530"></a>00530 {
<a name="l00531"></a>00531   <span class="keyword">static</span> U8 tmp_memory;
<a name="l00532"></a>00532   <span class="keyword">static</span> U16 tmp_page;
<a name="l00533"></a>00533 
<a name="l00534"></a>00534   <span class="keywordflow">if</span> (!<a class="code" href="a00030.html#bcae11a444dc30fdffd0e82a22af2fc7">is_isp_forced</a>()) <a class="code" href="a00030.html#5d28db34d36ff3888f49976e45f9ebd1">force_isp</a>(TRUE);
<a name="l00535"></a>00535 
<a name="l00536"></a>00536   <a class="code" href="a00030.html#72b5d479cbc5c21ca31a3b96d758385f">dfu_status</a> = <a class="code" href="a00031.html#2403320c41f08e7567cb169de5db66b3">STATUS_OK</a>;
<a name="l00537"></a>00537 
<a name="l00538"></a>00538   Usb_read_endpoint_data(EP_CONTROL, 16); <span class="comment">// Dummy read: wValue.</span>
<a name="l00539"></a>00539   Usb_read_endpoint_data(EP_CONTROL, 16); <span class="comment">// Dummy read: wIndex.</span>
<a name="l00540"></a>00540   <a class="code" href="a00030.html#2f00e80c587129859a23d409c849cb9d">length</a> = Usb_read_endpoint_data(EP_CONTROL, 16);
<a name="l00541"></a>00541   <a class="code" href="a00030.html#2f00e80c587129859a23d409c849cb9d">length</a> = usb_format_usb_to_mcu_data(16, <a class="code" href="a00030.html#2f00e80c587129859a23d409c849cb9d">length</a>);
<a name="l00542"></a>00542   Usb_ack_setup_received_free();
<a name="l00543"></a>00543 
<a name="l00544"></a>00544   <span class="keywordflow">if</span> (<a class="code" href="a00030.html#2f00e80c587129859a23d409c849cb9d">length</a>)
<a name="l00545"></a>00545   {
<a name="l00546"></a>00546     <span class="keywordflow">while</span> (!Is_usb_control_out_received());
<a name="l00547"></a>00547     Usb_reset_endpoint_fifo_access(EP_CONTROL);
<a name="l00548"></a>00548 
<a name="l00549"></a>00549     <a class="code" href="a00030.html#10507ab3bbf2da5fef97e2c2d55a1bef">cmd_group</a> = Usb_read_endpoint_data(EP_CONTROL, 8);
<a name="l00550"></a>00550     <a class="code" href="a00030.html#4f661e7cb6f9a5ded3ac456d0ab7d319">cmd</a> = Usb_read_endpoint_data(EP_CONTROL, 8);
<a name="l00551"></a>00551     <span class="keywordflow">switch</span> (<a class="code" href="a00030.html#10507ab3bbf2da5fef97e2c2d55a1bef">cmd_group</a>)
<a name="l00552"></a>00552     {
<a name="l00553"></a>00553     <span class="keywordflow">case</span> <a class="code" href="a00030.html#eb26fb98af27b1b6124e6d4b04441776">CMD_GRP_DNLOAD</a>:
<a name="l00554"></a>00554       <span class="keywordflow">if</span> (<a class="code" href="a00030.html#2361500f6c05783fa72cb2054c93e3f0">security_active</a>)
<a name="l00555"></a>00555       {
<a name="l00556"></a>00556         <span class="keywordflow">goto</span> unsupported_request;
<a name="l00557"></a>00557       }
<a name="l00558"></a>00558       <span class="keywordflow">if</span> (!<a class="code" href="a00030.html#10c0d82cffcef9ae75dc19306f167309">get_and_check_mem_range</a>()) <span class="keywordflow">break</span>;
<a name="l00559"></a>00559       <span class="keywordflow">if</span> (!<a class="code" href="a00030.html#25bcfc8e0357e922449012b0d41e30c7">MEMORY_ACCESS</a>[<a class="code" href="a00030.html#374fbbe1cfcd927515a99f5cdfc3dee7">memory</a>].<a class="code" href="a00030.html#76c4ac28168870c768186fd58667751c">write</a>)
<a name="l00560"></a>00560       {
<a name="l00561"></a>00561         <a class="code" href="a00030.html#72b5d479cbc5c21ca31a3b96d758385f">dfu_status</a> = <a class="code" href="a00031.html#fd69c5c712eb452dce7b77919198dfba">STATUS_errWRITE</a>;
<a name="l00562"></a>00562         <span class="keywordflow">break</span>;
<a name="l00563"></a>00563       }
<a name="l00564"></a>00564       <span class="keywordflow">switch</span> (<a class="code" href="a00030.html#4f661e7cb6f9a5ded3ac456d0ab7d319">cmd</a>)
<a name="l00565"></a>00565       {
<a name="l00566"></a>00566       <span class="keywordflow">case</span> <a class="code" href="a00030.html#98292ffceeb8fd22e929fe412223a6a4">CMD_PROGRAM_START</a>:
<a name="l00567"></a>00567         Usb_ack_control_out_received_free();
<a name="l00568"></a>00568         <a class="code" href="a00030.html#d32db56ce57a924629571ebbb28066f0">write_mem</a>();
<a name="l00569"></a>00569         <span class="keywordflow">break</span>;
<a name="l00570"></a>00570 
<a name="l00571"></a>00571       <span class="keywordflow">default</span>:
<a name="l00572"></a>00572         <span class="keywordflow">goto</span> unsupported_request;
<a name="l00573"></a>00573       }
<a name="l00574"></a>00574       <span class="keywordflow">break</span>;
<a name="l00575"></a>00575 
<a name="l00576"></a>00576     <span class="keywordflow">case</span> <a class="code" href="a00030.html#3e7061dc18462050457e33662f885f63">CMD_GRP_UPLOAD</a>:
<a name="l00577"></a>00577       <span class="keywordflow">if</span> (security_active)
<a name="l00578"></a>00578       {
<a name="l00579"></a>00579         <span class="keywordflow">goto</span> unsupported_request;
<a name="l00580"></a>00580       }
<a name="l00581"></a>00581       <span class="keywordflow">if</span> (!<a class="code" href="a00030.html#10c0d82cffcef9ae75dc19306f167309">get_and_check_mem_range</a>()) <span class="keywordflow">break</span>;
<a name="l00582"></a>00582       <span class="keywordflow">if</span> (!<a class="code" href="a00030.html#25bcfc8e0357e922449012b0d41e30c7">MEMORY_ACCESS</a>[<a class="code" href="a00030.html#374fbbe1cfcd927515a99f5cdfc3dee7">memory</a>].<a class="code" href="a00030.html#2ee0f257169fa94a36a103b84afa7101">read</a>)
<a name="l00583"></a>00583       {
<a name="l00584"></a>00584         <a class="code" href="a00030.html#72b5d479cbc5c21ca31a3b96d758385f">dfu_status</a> = <a class="code" href="a00031.html#0d02117b3b3ac0e37ea30c91a7f2a43a">STATUS_errVERIFY</a>;
<a name="l00585"></a>00585         <span class="keywordflow">break</span>;
<a name="l00586"></a>00586       }
<a name="l00587"></a>00587       <span class="keywordflow">switch</span> (<a class="code" href="a00030.html#4f661e7cb6f9a5ded3ac456d0ab7d319">cmd</a>)
<a name="l00588"></a>00588       {
<a name="l00589"></a>00589       <span class="keywordflow">case</span> <a class="code" href="a00030.html#929b607d33ea7317ece0130f4bd7dea9">CMD_READ_MEMORY</a>:
<a name="l00590"></a>00590         <span class="keywordflow">break</span>;
<a name="l00591"></a>00591 
<a name="l00592"></a>00592       <span class="keywordflow">case</span> <a class="code" href="a00030.html#de21f96609d5cf42318df9b16c4ced73">CMD_BLANK_CHECK</a>:
<a name="l00593"></a>00593         <a class="code" href="a00030.html#d2e5148ff309825eba2285d628fd92b7">erase_check_mem</a>();
<a name="l00594"></a>00594         <span class="keywordflow">break</span>;
<a name="l00595"></a>00595 
<a name="l00596"></a>00596       <span class="keywordflow">default</span>:
<a name="l00597"></a>00597         <span class="keywordflow">goto</span> unsupported_request;
<a name="l00598"></a>00598       }
<a name="l00599"></a>00599       <span class="keywordflow">break</span>;
<a name="l00600"></a>00600 
<a name="l00601"></a>00601     <span class="keywordflow">case</span> <a class="code" href="a00030.html#6440653aacc649380510aa31830f3ad5">CMD_GRP_EXEC</a>:
<a name="l00602"></a>00602       <span class="keywordflow">switch</span> (<a class="code" href="a00030.html#4f661e7cb6f9a5ded3ac456d0ab7d319">cmd</a>)
<a name="l00603"></a>00603       {
<a name="l00604"></a>00604       <span class="keywordflow">case</span> <a class="code" href="a00030.html#73d541696536a935eec42edc03359e96">CMD_ERASE</a>:
<a name="l00605"></a>00605         <span class="keywordflow">switch</span> (Usb_read_endpoint_data(EP_CONTROL, 8))
<a name="l00606"></a>00606         {
<a name="l00607"></a>00607         <span class="keywordflow">case</span> <a class="code" href="a00030.html#7cab61d2d864b9953bfe36de80bb6f01">CMD_ERASE_ARG_CHIP</a>:
<a name="l00608"></a>00608           <a class="code" href="a00030.html#374fbbe1cfcd927515a99f5cdfc3dee7">memory</a> = <a class="code" href="a00030.html#797e277b6bad54cbefc14fe6a4ef0605">MEM_FLASH</a>;
<a name="l00609"></a>00609           <a class="code" href="a00030.html#52058289997b205a29f0908602c345ec">end_address</a>.<a class="code" href="a00001.html#ed0dac19c4b2093be47ed2dceab2a437">long_address</a> = <a class="code" href="a00030.html#4442c564b99c01cf95a13195118b3a79">start_address</a>.<a class="code" href="a00001.html#ed0dac19c4b2093be47ed2dceab2a437">long_address</a> = 0;
<a name="l00610"></a>00610           <a class="code" href="a00020.html#7c05cca97169ee6888828c40243c0191">flashc_lock_all_regions</a>(FALSE);
<a name="l00611"></a>00611           <a class="code" href="a00020.html#230f4c4dcf517606a540dfa1df3efa91">flashc_erase_all_pages</a>(FALSE);
<a name="l00612"></a>00612           security_active = FALSE;
<a name="l00613"></a>00613           <span class="keywordflow">break</span>;
<a name="l00614"></a>00614 
<a name="l00615"></a>00615         <span class="keywordflow">default</span>:
<a name="l00616"></a>00616           <span class="keywordflow">goto</span> unsupported_request;
<a name="l00617"></a>00617         }
<a name="l00618"></a>00618         <span class="keywordflow">break</span>;
<a name="l00619"></a>00619 
<a name="l00620"></a>00620       <span class="keywordflow">case</span> <a class="code" href="a00030.html#9718c80eab4acb4586586415eb040a13">CMD_START_APPLI</a>:
<a name="l00621"></a>00621         <span class="keywordflow">switch</span> (Usb_read_endpoint_data(EP_CONTROL, 8))
<a name="l00622"></a>00622         {
<a name="l00623"></a>00623         <span class="keywordflow">case</span> <a class="code" href="a00030.html#0da96ca4396e799943d1a84adb3980ea">CMD_START_APPLI_ARG_RESET</a>:
<a name="l00624"></a>00624           <a class="code" href="a00030.html#4ea17de3f3e93df51ea8f68aa9ca5f9f">usb_dfu_stop</a>();
<a name="l00625"></a>00625           Disable_global_interrupt();
<a name="l00626"></a>00626           AVR32_WDT.ctrl = AVR32_WDT_CTRL_EN_MASK |
<a name="l00627"></a>00627                            (10 &lt;&lt; AVR32_WDT_CTRL_PSEL_OFFSET) |
<a name="l00628"></a>00628                            (AVR32_WDT_KEY_VALUE &lt;&lt; AVR32_WDT_CTRL_KEY_OFFSET);
<a name="l00629"></a>00629           AVR32_WDT.ctrl = AVR32_WDT_CTRL_EN_MASK |
<a name="l00630"></a>00630                            (10 &lt;&lt; AVR32_WDT_CTRL_PSEL_OFFSET) |
<a name="l00631"></a>00631                            ((~AVR32_WDT_KEY_VALUE &lt;&lt; AVR32_WDT_CTRL_KEY_OFFSET) &amp; AVR32_WDT_CTRL_KEY_MASK);
<a name="l00632"></a>00632           <span class="keywordflow">while</span> (1);
<a name="l00633"></a>00633           <span class="keywordflow">break</span>;
<a name="l00634"></a>00634 
<a name="l00635"></a>00635         <span class="keywordflow">case</span> <a class="code" href="a00030.html#fd8d379083e82679309bbf8e7248a581">CMD_START_APPLI_ARG_NO_RESET</a>:
<a name="l00636"></a>00636           <a class="code" href="a00030.html#4ea17de3f3e93df51ea8f68aa9ca5f9f">usb_dfu_stop</a>();
<a name="l00637"></a>00637           <a class="code" href="a00024.html#beb71cd0f39604bc0a2d1365f5c3c16b">sys_clk_gen_stop</a>();
<a name="l00638"></a>00638           <a class="code" href="a00024.html#6f08d367b9ecd26d8600fd7462593c3a">wait_10_ms</a>();
<a name="l00639"></a>00639           <a class="code" href="a00016.html#628154782d795e03dc8a807545dd0622">boot_program</a>();
<a name="l00640"></a>00640           <span class="keywordflow">break</span>;
<a name="l00641"></a>00641 
<a name="l00642"></a>00642         <span class="keywordflow">default</span>:
<a name="l00643"></a>00643           <span class="keywordflow">goto</span> unsupported_request;
<a name="l00644"></a>00644         }
<a name="l00645"></a>00645         <span class="keywordflow">break</span>;
<a name="l00646"></a>00646 
<a name="l00647"></a>00647       <span class="keywordflow">default</span>:
<a name="l00648"></a>00648         <span class="keywordflow">goto</span> unsupported_request;
<a name="l00649"></a>00649       }
<a name="l00650"></a>00650       <span class="keywordflow">break</span>;
<a name="l00651"></a>00651 
<a name="l00652"></a>00652     <span class="keywordflow">case</span> <a class="code" href="a00030.html#1e1b93df0559e425c04f4d4ca2920753">CMD_GRP_SELECT</a>:
<a name="l00653"></a>00653       <span class="keywordflow">if</span> (security_active)
<a name="l00654"></a>00654       {
<a name="l00655"></a>00655         <span class="keywordflow">goto</span> unsupported_request;
<a name="l00656"></a>00656       }
<a name="l00657"></a>00657       <span class="keywordflow">switch</span> (<a class="code" href="a00030.html#4f661e7cb6f9a5ded3ac456d0ab7d319">cmd</a>)
<a name="l00658"></a>00658       {
<a name="l00659"></a>00659       <span class="keywordflow">case</span> <a class="code" href="a00030.html#91718c9f4c48630faceac10d005cbce6">CMD_SELECT_MEMORY</a>:
<a name="l00660"></a>00660         <span class="keywordflow">switch</span> (Usb_read_endpoint_data(EP_CONTROL, 8))
<a name="l00661"></a>00661         {
<a name="l00662"></a>00662         <span class="keywordflow">case</span> <a class="code" href="a00030.html#e2c20d9b274a70e96b297cbdc901fa02">CMD_SELECT_MEMORY_ARG_UNIT</a>:
<a name="l00663"></a>00663           <span class="keywordflow">switch</span> (tmp_memory = Usb_read_endpoint_data(EP_CONTROL, 8))
<a name="l00664"></a>00664           {
<a name="l00665"></a>00665           <span class="keywordflow">case</span> <a class="code" href="a00030.html#797e277b6bad54cbefc14fe6a4ef0605">MEM_FLASH</a>:
<a name="l00666"></a>00666           <span class="keywordflow">case</span> <a class="code" href="a00030.html#a9997d933806a6fb207fb55930432a00">MEM_EEPROM</a>:
<a name="l00667"></a>00667           <span class="keywordflow">case</span> <a class="code" href="a00030.html#f82d999ce5fc205a187090bfbefef388">MEM_SECURITY</a>:
<a name="l00668"></a>00668           <span class="keywordflow">case</span> <a class="code" href="a00030.html#4d3c302c0479b8044fefd249ddd501d0">MEM_CONFIGURATION</a>:
<a name="l00669"></a>00669           <span class="keywordflow">case</span> <a class="code" href="a00030.html#7312bc7c0f3695bff0b7fbc15dbb37f8">MEM_BOOTLOADER</a>:
<a name="l00670"></a>00670           <span class="keywordflow">case</span> <a class="code" href="a00030.html#81160b040a07265ec9ea9ade3480c135">MEM_SIGNATURE</a>:
<a name="l00671"></a>00671           <span class="keywordflow">case</span> <a class="code" href="a00030.html#1168f49bb6b4954943fba4baa4a6ea8f">MEM_USER</a>:
<a name="l00672"></a>00672             <a class="code" href="a00030.html#374fbbe1cfcd927515a99f5cdfc3dee7">memory</a> = tmp_memory;
<a name="l00673"></a>00673             <a class="code" href="a00030.html#52058289997b205a29f0908602c345ec">end_address</a>.<a class="code" href="a00001.html#ed0dac19c4b2093be47ed2dceab2a437">long_address</a> = <a class="code" href="a00030.html#4442c564b99c01cf95a13195118b3a79">start_address</a>.<a class="code" href="a00001.html#ed0dac19c4b2093be47ed2dceab2a437">long_address</a> = 0;
<a name="l00674"></a>00674             <span class="keywordflow">break</span>;
<a name="l00675"></a>00675 
<a name="l00676"></a>00676           <span class="keywordflow">default</span>:
<a name="l00677"></a>00677             <a class="code" href="a00030.html#72b5d479cbc5c21ca31a3b96d758385f">dfu_status</a> = <a class="code" href="a00031.html#e32f24e7d30d446dd9f487f4d5e55742">STATUS_errADDRESS</a>;
<a name="l00678"></a>00678           }
<a name="l00679"></a>00679           <span class="keywordflow">break</span>;
<a name="l00680"></a>00680 
<a name="l00681"></a>00681         <span class="keywordflow">case</span> <a class="code" href="a00030.html#786167bf73a3c317633a5a89a734b13e">CMD_SELECT_MEMORY_ARG_PAGE</a>:
<a name="l00682"></a>00682           MSB(tmp_page) = Usb_read_endpoint_data(EP_CONTROL, 8);
<a name="l00683"></a>00683           LSB(tmp_page) = Usb_read_endpoint_data(EP_CONTROL, 8);
<a name="l00684"></a>00684           <span class="keywordflow">if</span> (tmp_page &lt;= <a class="code" href="a00030.html#fa623b1048e8537f6aa02080171aea63">MEMORY_END_ADDRESS</a>[<a class="code" href="a00030.html#374fbbe1cfcd927515a99f5cdfc3dee7">memory</a>].page)
<a name="l00685"></a>00685           {
<a name="l00686"></a>00686             <a class="code" href="a00030.html#52058289997b205a29f0908602c345ec">end_address</a>.<a class="code" href="a00001.html#5a3f76da8245f4f59dfcaec88659f90c">page</a> = <a class="code" href="a00030.html#4442c564b99c01cf95a13195118b3a79">start_address</a>.<a class="code" href="a00001.html#5a3f76da8245f4f59dfcaec88659f90c">page</a> = tmp_page;
<a name="l00687"></a>00687           }
<a name="l00688"></a>00688           <span class="keywordflow">else</span> <a class="code" href="a00030.html#72b5d479cbc5c21ca31a3b96d758385f">dfu_status</a> = <a class="code" href="a00031.html#e32f24e7d30d446dd9f487f4d5e55742">STATUS_errADDRESS</a>;
<a name="l00689"></a>00689           <span class="keywordflow">break</span>;
<a name="l00690"></a>00690 
<a name="l00691"></a>00691         <span class="keywordflow">default</span>:
<a name="l00692"></a>00692           <span class="keywordflow">goto</span> unsupported_request;
<a name="l00693"></a>00693         }
<a name="l00694"></a>00694         <span class="keywordflow">break</span>;
<a name="l00695"></a>00695 
<a name="l00696"></a>00696       <span class="keywordflow">default</span>:
<a name="l00697"></a>00697         <span class="keywordflow">goto</span> unsupported_request;
<a name="l00698"></a>00698       }
<a name="l00699"></a>00699       <span class="keywordflow">break</span>;
<a name="l00700"></a>00700 
<a name="l00701"></a>00701     <span class="keywordflow">default</span>:
<a name="l00702"></a>00702 unsupported_request:
<a name="l00703"></a>00703       <a class="code" href="a00030.html#72b5d479cbc5c21ca31a3b96d758385f">dfu_status</a> = <a class="code" href="a00031.html#ff7b3e2c3070cd0238186033151c4796">STATUS_errSTALLEDPKT</a>;
<a name="l00704"></a>00704     }
<a name="l00705"></a>00705 
<a name="l00706"></a>00706     Usb_ack_control_out_received_free();
<a name="l00707"></a>00707   }
<a name="l00708"></a>00708 
<a name="l00709"></a>00709   <a class="code" href="a00030.html#dab58f74f165f09a20d44012d0e5b701">usb_dfu_status</a> = <a class="code" href="a00030.html#72b5d479cbc5c21ca31a3b96d758385f">dfu_status</a>;
<a name="l00710"></a>00710   <span class="keywordflow">if</span> (<a class="code" href="a00030.html#dab58f74f165f09a20d44012d0e5b701">usb_dfu_status</a> != <a class="code" href="a00031.html#2403320c41f08e7567cb169de5db66b3">STATUS_OK</a> &amp;&amp;
<a name="l00711"></a>00711       <a class="code" href="a00030.html#dab58f74f165f09a20d44012d0e5b701">usb_dfu_status</a> != <a class="code" href="a00031.html#bef4e4e1a2737dec9c0e1412b66b7636">STATUS_errCHECK_ERASED</a>) <span class="keywordflow">return</span> FALSE;
<a name="l00712"></a>00712 
<a name="l00713"></a>00713   Usb_ack_control_in_ready_send();
<a name="l00714"></a>00714   <span class="keywordflow">while</span> (!Is_usb_control_in_ready());
<a name="l00715"></a>00715   <span class="keywordflow">return</span> TRUE;
<a name="l00716"></a>00716 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="62dbc4daf5f5254dc94c0b1c00ae1979"></a><!-- doxytag: member="usb_dfu.h::usb_dfu_init" ref="62dbc4daf5f5254dc94c0b1c00ae1979" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void usb_dfu_init           </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname">          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>
Definition at line <a class="el" href="a00055.html#l00493">493</a> of file <a class="el" href="a00055.html">usb_dfu.c</a>.
<p>
References <a class="el" href="a00045.html#l00075">flashc_get_flash_size()</a>, <a class="el" href="a00045.html#l00301">flashc_is_security_bit_active()</a>, <a class="el" href="a00055.html#l00168">address_t::long_address</a>, <a class="el" href="a00055.html#l00121">MEM_FLASH</a>, <a class="el" href="a00055.html#l00190">MEMORY_END_ADDRESS</a>, <a class="el" href="a00055.html#l00135">PRODUCT_ID_ADDRESS</a>, <a class="el" href="a00055.html#l00177">PRODUCT_INF</a>, and <a class="el" href="a00055.html#l00136">PRODUCT_REVISION_ADDRESS</a>.
<p>
Referenced by <a class="el" href="a00049.html#l00194">main()</a>.<div class="fragment"><pre class="fragment"><a name="l00494"></a>00494 {
<a name="l00495"></a>00495   <a class="code" href="a00030.html#52ebe39948f0519a749b834767124cad">PRODUCT_INF</a>[<a class="code" href="a00030.html#e38961fa867d62efaf9fd7b35a6c9831">PRODUCT_ID_ADDRESS</a>] =
<a name="l00496"></a>00496     Rd_bitfield(Get_system_register(AVR32_CONFIG0), AVR32_CONFIG0_PROCESSORID_MASK);
<a name="l00497"></a>00497   <a class="code" href="a00030.html#52ebe39948f0519a749b834767124cad">PRODUCT_INF</a>[<a class="code" href="a00030.html#6bcaecfc51c7d24e73cfecb15dbfbeaa">PRODUCT_REVISION_ADDRESS</a>] =
<a name="l00498"></a>00498     Rd_bitfield(Get_system_register(AVR32_CONFIG0), AVR32_CONFIG0_PROCESSORREVISION_MASK);
<a name="l00499"></a>00499 
<a name="l00500"></a>00500   <a class="code" href="a00030.html#fa623b1048e8537f6aa02080171aea63">MEMORY_END_ADDRESS</a>[<a class="code" href="a00030.html#797e277b6bad54cbefc14fe6a4ef0605">MEM_FLASH</a>].<a class="code" href="a00001.html#ed0dac19c4b2093be47ed2dceab2a437">long_address</a> = <a class="code" href="a00020.html#8071c315b02d038c49fa0bf89a40ba1b">flashc_get_flash_size</a>() - 1;
<a name="l00501"></a>00501 
<a name="l00502"></a>00502   <a class="code" href="a00030.html#2361500f6c05783fa72cb2054c93e3f0">security_active</a> = <a class="code" href="a00020.html#03df73f0be08f7bc503f3c336b1abdc1">flashc_is_security_bit_active</a>();
<a name="l00503"></a>00503 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="e699cfe7ed5c0b528f080d5e056a1503"></a><!-- doxytag: member="usb_dfu.h::usb_dfu_upload" ref="e699cfe7ed5c0b528f080d5e056a1503" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">Bool usb_dfu_upload           </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname">          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Management of the DFU_UPLOAD requests. 
<p>

<p>
Definition at line <a class="el" href="a00055.html#l00721">721</a> of file <a class="el" href="a00055.html">usb_dfu.c</a>.
<p>
References <a class="el" href="a00055.html#l00100">CMD_BLANK_CHECK</a>, <a class="el" href="a00055.html#l00091">CMD_GRP_UPLOAD</a>, <a class="el" href="a00055.html#l00099">CMD_READ_MEMORY</a>, <a class="el" href="a00055.html#l00083">dfu_format_mcu_to_dfu_data</a>, <a class="el" href="a00055.html#l00172">address_t::page_offset</a>, <a class="el" href="a00055.html#l00428">read_mem()</a>, <a class="el" href="a00055.html#l00292">start_address</a>, <a class="el" href="a00056.html#l00069">STATUS_errCHECK_ERASED</a>, <a class="el" href="a00056.html#l00079">STATUS_errSTALLEDPKT</a>, and <a class="el" href="a00056.html#l00064">STATUS_OK</a>.
<p>
Referenced by <a class="el" href="a00057.html#l00087">usb_user_read_request()</a>.<div class="fragment"><pre class="fragment"><a name="l00722"></a>00722 {
<a name="l00723"></a>00723   Usb_ack_setup_received_free();
<a name="l00724"></a>00724   Usb_reset_endpoint_fifo_access(EP_CONTROL);
<a name="l00725"></a>00725 
<a name="l00726"></a>00726   <span class="keywordflow">if</span> (<a class="code" href="a00030.html#10507ab3bbf2da5fef97e2c2d55a1bef">cmd_group</a> == <a class="code" href="a00030.html#3e7061dc18462050457e33662f885f63">CMD_GRP_UPLOAD</a> &amp;&amp;
<a name="l00727"></a>00727       (<a class="code" href="a00030.html#72b5d479cbc5c21ca31a3b96d758385f">dfu_status</a> == <a class="code" href="a00031.html#2403320c41f08e7567cb169de5db66b3">STATUS_OK</a> ||
<a name="l00728"></a>00728        <a class="code" href="a00030.html#72b5d479cbc5c21ca31a3b96d758385f">dfu_status</a> == <a class="code" href="a00031.html#bef4e4e1a2737dec9c0e1412b66b7636">STATUS_errCHECK_ERASED</a>))
<a name="l00729"></a>00729   {
<a name="l00730"></a>00730     <span class="keywordflow">switch</span> (<a class="code" href="a00030.html#4f661e7cb6f9a5ded3ac456d0ab7d319">cmd</a>)
<a name="l00731"></a>00731     {
<a name="l00732"></a>00732     <span class="keywordflow">case</span> <a class="code" href="a00030.html#929b607d33ea7317ece0130f4bd7dea9">CMD_READ_MEMORY</a>:
<a name="l00733"></a>00733       <a class="code" href="a00030.html#c47b9a242f66117db14205a3d75b6c0c">read_mem</a>();
<a name="l00734"></a>00734       <span class="keywordflow">break</span>;
<a name="l00735"></a>00735 
<a name="l00736"></a>00736     <span class="keywordflow">case</span> <a class="code" href="a00030.html#de21f96609d5cf42318df9b16c4ced73">CMD_BLANK_CHECK</a>:
<a name="l00737"></a>00737       Usb_write_endpoint_data(EP_CONTROL, 16, <a class="code" href="a00030.html#7a1cd9007045ae21acde0b48f7bdd9af">dfu_format_mcu_to_dfu_data</a>(16, <a class="code" href="a00030.html#4442c564b99c01cf95a13195118b3a79">start_address</a>.<a class="code" href="a00001.html#7db971aec662548d8c5f3620b0ee7549">page_offset</a>));
<a name="l00738"></a>00738       <span class="keywordflow">break</span>;
<a name="l00739"></a>00739 
<a name="l00740"></a>00740     <span class="keywordflow">default</span>:
<a name="l00741"></a>00741       <span class="keywordflow">goto</span> unsupported_request;
<a name="l00742"></a>00742     }
<a name="l00743"></a>00743   }
<a name="l00744"></a>00744   <span class="keywordflow">else</span>
<a name="l00745"></a>00745   {
<a name="l00746"></a>00746 unsupported_request:
<a name="l00747"></a>00747     <a class="code" href="a00030.html#72b5d479cbc5c21ca31a3b96d758385f">dfu_status</a> = <a class="code" href="a00031.html#ff7b3e2c3070cd0238186033151c4796">STATUS_errSTALLEDPKT</a>;
<a name="l00748"></a>00748   }
<a name="l00749"></a>00749 
<a name="l00750"></a>00750   <a class="code" href="a00030.html#dab58f74f165f09a20d44012d0e5b701">usb_dfu_status</a> = <a class="code" href="a00030.html#72b5d479cbc5c21ca31a3b96d758385f">dfu_status</a>;
<a name="l00751"></a>00751   <span class="keywordflow">if</span> (<a class="code" href="a00030.html#dab58f74f165f09a20d44012d0e5b701">usb_dfu_status</a> != <a class="code" href="a00031.html#2403320c41f08e7567cb169de5db66b3">STATUS_OK</a> &amp;&amp;
<a name="l00752"></a>00752       <a class="code" href="a00030.html#dab58f74f165f09a20d44012d0e5b701">usb_dfu_status</a> != <a class="code" href="a00031.html#bef4e4e1a2737dec9c0e1412b66b7636">STATUS_errCHECK_ERASED</a>) <span class="keywordflow">return</span> FALSE;
<a name="l00753"></a>00753 
<a name="l00754"></a>00754   <span class="keywordflow">if</span> (Usb_byte_count(EP_CONTROL)) Usb_ack_control_in_ready_send();
<a name="l00755"></a>00755   <span class="keywordflow">while</span> (!Is_usb_control_out_received());
<a name="l00756"></a>00756   Usb_ack_control_out_received_free();
<a name="l00757"></a>00757   <span class="keywordflow">return</span> TRUE;
<a name="l00758"></a>00758 }
</pre></div>
<p>

</div>
</div><p>
<hr><h2>Variable Documentation</h2>
<a class="anchor" name="ab5b7c0a4e01dcfaa3985722d933afbe"></a><!-- doxytag: member="usb_dfu.h::usb_dfu_state" ref="ab5b7c0a4e01dcfaa3985722d933afbe" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">U8 <a class="el" href="a00031.html#ab5b7c0a4e01dcfaa3985722d933afbe">usb_dfu_state</a>          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>
Definition at line <a class="el" href="a00055.html#l00299">299</a> of file <a class="el" href="a00055.html">usb_dfu.c</a>.
<p>
Referenced by <a class="el" href="a00057.html#l00087">usb_user_read_request()</a>.
</div>
</div><p>
<a class="anchor" name="dab58f74f165f09a20d44012d0e5b701"></a><!-- doxytag: member="usb_dfu.h::usb_dfu_status" ref="dab58f74f165f09a20d44012d0e5b701" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">U8 <a class="el" href="a00031.html#dab58f74f165f09a20d44012d0e5b701">usb_dfu_status</a>          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>
Definition at line <a class="el" href="a00055.html#l00298">298</a> of file <a class="el" href="a00055.html">usb_dfu.c</a>.
<p>
Referenced by <a class="el" href="a00057.html#l00087">usb_user_read_request()</a>.
</div>
</div><p>
<hr size="1"><address style="align: right;"><small>Generated on Thu Sep 20 12:17:25 2007 for AVR32 - USB DFU Example: ISP by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.5.1-p1 </small></address>
</body>
</html>
